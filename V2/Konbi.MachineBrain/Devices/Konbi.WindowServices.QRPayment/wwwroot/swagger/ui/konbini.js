var konbini = konbini || {};
(function () {

    /* Application paths *****************************************/

    //Current application root path (including virtual directory if exists).
    konbini.appPath = konbini.appPath || '/';

    /* AUTHORIZATION **********************************************/
    //Implements Authorization API that simplifies usage of authorization scripts generated by konbini.

    konbini.auth = konbini.auth || {};

    konbini.auth.tokenCookieName = 'Konbini.AuthToken';
    konbini.auth.tokenHeaderName = 'Authorization';

    konbini.auth.setToken = function (authToken, expireDate) {
        konbini.utils.setCookieValue(konbini.auth.tokenCookieName, authToken, expireDate, konbini.appPath);
    };

    konbini.auth.getToken = function () {
        return konbini.utils.getCookieValue(konbini.auth.tokenCookieName);
    }

    konbini.auth.clearToken = function () {
        konbini.auth.setToken();
    }

    /* UTILS ***************************************************/

    konbini.utils = konbini.utils || {};

    /**
         * Sets a cookie value for given key.
         * This is a simple implementation created to be used by konbini.
         * Please use a complete cookie library if you need.
         * @param {string} key
         * @param {string} value
         * @param {Date} expireDate (optional). If not specified the cookie will expire at the end of session.
         * @param {string} path (optional)
         */
    konbini.utils.setCookieValue = function (key, value, expireDate, path) {
        var cookieValue = encodeURIComponent(key) + '=';

        if (value) {
            cookieValue = cookieValue + encodeURIComponent(value);
        }

        if (expireDate) {
            cookieValue = cookieValue + "; expires=" + expireDate.toUTCString();
        }

        if (path) {
            cookieValue = cookieValue + "; path=" + path;
        }

        document.cookie = cookieValue;
    };

    /**
     * Gets a cookie with given key.
     * This is a simple implementation created to be used by konbini.
     * Please use a complete cookie library if you need.
     * @param {string} key
     * @returns {string} Cookie value or null
     */
    konbini.utils.getCookieValue = function (key) {
        var equalities = document.cookie.split('; ');
        for (var i = 0; i < equalities.length; i++) {
            if (!equalities[i]) {
                continue;
            }

            var splitted = equalities[i].split('=');
            if (splitted.length != 2) {
                continue;
            }

            if (decodeURIComponent(splitted[0]) === key) {
                return decodeURIComponent(splitted[1] || '');
            }
        }

        return null;
    };

    /**
     * Deletes cookie for given key.
     * This is a simple implementation created to be used by konbini.
     * Please use a complete cookie library if you need.
     * @param {string} key
     * @param {string} path (optional)
     */
    konbini.utils.deleteCookie = function (key, path) {
        var cookieValue = encodeURIComponent(key) + '=';

        cookieValue = cookieValue + "; expires=" + (new Date(new Date().getTime() - 86400000)).toUTCString();

        if (path) {
            cookieValue = cookieValue + "; path=" + path;
        }

        document.cookie = cookieValue;
    }

    /* SECURITY ***************************************/
    konbini.security = konbini.security || {};
    konbini.security.antiForgery = konbini.security.antiForgery || {};

    konbini.security.antiForgery.tokenCookieName = 'XSRF-TOKEN';
    konbini.security.antiForgery.tokenHeaderName = 'X-XSRF-TOKEN';

    konbini.security.antiForgery.getToken = function () {
        return konbini.utils.getCookieValue(konbini.security.antiForgery.tokenCookieName);
    };

})();